<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Decipline</title>
<link rel="icon" href="icon.png" type="image/png">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- เพิ่ม SortableJS library -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>


<style>
/* ===== Body & Container ===== */
body {
  margin:0;
  font-family: 'Segoe UI', Roboto, Arial, sans-serif;
  background: #0d0d0d;   /* ดำเข้ม */
  color: #e0e0e0;         /* ตัวหนังสือสว่าง */
}
.container { display:flex; min-height:100vh; }


/* ===== Sidebar ===== */
.sidebar {
  width:30%;
  background:#1a1a1a;     /* sidebar ดำลึก */
  color:#fff;
  display:flex;
  flex-direction:column;
  transition: width 0.3s;
}
.sidebar h2 {
  text-align:center;
  padding:15px 0;
  margin:0;
  border-bottom:1px solid #333;
  color: #f0e6d2;          /* สีหรูแบบทองอ่อน */
}
.sidebar button {
  padding:15px;
  background:none;
  color:#fff;
  border:none;
  text-align:left;
  cursor:pointer;
  width:100%;
  border-bottom:1px solid #333;
  font-size:16px;
  transition: 0.2s;
}
.sidebar button.active {
  background:#d4af37;       /* สีทองเมทัลลิก */
  color:#0d0d0d;
}
.sidebar button:hover {
  background:#333;
}

/* ===== Main ===== */
.main {
  flex:1;
  padding:20px;
  overflow-x:auto;
  background:#0d0d0d;
}
h1,h2 { color:#f0e6d2; }

/* ===== Inputs & Buttons ===== */
.input-box input {
  width:48%;
  padding:12px;
  font-size:16px;
  border-radius:5px;
  border:1px solid #555;
  background:#1a1a1a;
  color:#f0e6d2;
}
.input-box button, .graph-buttons button, .delete-box button, #toggle-button {
  padding:12px;
  font-size:16px;
  border:none;
  border-radius:5px;
  cursor:pointer;
  flex:1 1 45%;
  min-width:120px;
  transition:0.2s;
}
.graph-buttons button.active { background:#967b22; color:#fff; }
.graph-buttons button:hover { background:#a5a4a5; }
.delete-box button { background:#ff4d4d; color:#fff; }
#toggle-button { background:#1a1a1a; color:#f0e6d2; margin-bottom:20px; }

/* ===== Tables ===== */
table {
  width:100%;
  display:block;
  overflow-x:auto;
  border-collapse:collapse;
  margin-bottom:20px;
  background:#1a1a1a;
  border-radius:8px;
  color:#e0e0e0;
}
th, td {
  padding:12px;
  border-bottom:1px solid #333;
  text-align:center;
  cursor:pointer;
}
th {
  background:#222;
  color:#f0e6d2;
}
tr.selected { background-color:#333; }

/* ===== Canvas ===== */
canvas { max-width:100%; height:auto; display:none; }
.sidebar {
  background: linear-gradient(180deg, #1a1a1a, #333333);
}
.graph-buttons button.active {
  background: linear-gradient(90deg, #d4af37, #ffd700);
  color:#0d0d0d;
}
.graph-buttons button.active {
  box-shadow: 0 0 8px #ffd700;
}
body {
  font-family: 'Playfair Display', 'Segoe UI', Roboto, sans-serif;
}
h1, h2 {
  font-family: 'Cinzel', serif;
  letter-spacing: 1px;
}
table {
  box-shadow: 0 2px 8px rgba(0,0,0,0.5);
}
tr:hover { background-color: #2a2a2a; }
tr.selected { background-color: #ac8b1f; } /* dark gold tone */
th { border-bottom: 2px solid #d4af37; }
td, th { padding: 14px; }

/* ===== ปุ่ม Input / Delete Luxury ===== */
.input-box button, .delete-box button {
  background: linear-gradient(145deg, #d4af37, #eed963); /* gradient ทองหรู */
  color: #0d0d0d; /* ตัวอักษรเข้ม */
  font-weight: 600;
  border-radius: 12px;
  padding: 14px 20px;
  box-shadow: 0 4px 15px rgba(212,175,55,0.6); /* shadow ทอง */
  transition: all 0.3s ease;
}

.input-box button:hover, .delete-box button:hover {
  transform: translateY(-2px) scale(1.05); /* เล็กน้อยลอยขึ้น */
  box-shadow: 0 6px 20px rgba(212,175,55,0.8); /* shadow เพิ่มขึ้น */
}

.input-box button:active, .delete-box button:active {
  transform: translateY(0) scale(0.98);
  box-shadow: 0 3px 10px rgba(212,175,55,0.6);
}

/* เพิ่ม transition ให้ input */
.input-box input {
  border: 1px solid #d4af37;
  background: #1a1a1a;
  color: #f0e6d2;
  box-shadow: inset 0 2px 5px rgba(212,175,55,0.2);
  transition: all 0.3s ease;
}

.input-box input:focus {
  border-color: #ffd700;
  box-shadow: 0 0 8px #ffd700;
  outline: none;
}

.hall-container { display:flex; flex-wrap:wrap; gap:20px; margin-top:20px; }
.hall-item { 
  position: relative; /* <-- เพิ่ม position relative */
  display:flex; 
  flex-direction:column; 
  align-items:center; 
  width:100%; 
  text-align:center;
  cursor: grab; /* <-- เปลี่ยน cursor ให้รู้ว่าลากได้ */
}
.hall-item img { 
  width:120px; 
  height:120px; 
  object-fit:cover; 
  border-radius:50%; 
  border:5px solid #ffd700; 
  box-shadow:0 0 15px rgba(255,215,0,0.7); 
  transition: transform 0.3s, box-shadow 0.3s; 
}
.hall-item img:hover { transform:scale(1.05); box-shadow:0 0 25px rgba(255,215,0,0.9); }
.hall-item span { margin-top:8px; font-weight:600; color:#f0e6d2; font-size: 18px; }

.hall-item button {
  font-weight: 600;
  font-size: 12px;
  transition: all 0.2s;
}
.hall-item button:hover {
  transform: scale(1.1);
  box-shadow: 0 0 8px rgba(255,0,0,0.7);
}

/* ===== ส่วน CSS ใหม่สำหรับ Rank ===== */
.rank-symbol {
    position: absolute;
    top: 0;
    left: 10px;
    font-size: 32px;
    font-weight: bold;
    color: #fff;
    text-shadow: 0 0 5px #000, 0 0 10px #ffd700, 0 0 15px #ffd700;
    pointer-events: none; /* ทำให้คลิกทะลุได้ */
}

/* ===== Goal Tab Luxury Style ===== */
.goal-summary {
  margin-top: 20px;
}

.progress-bar-container {
  width: 100%;
  background: #1a1a1a;
  border-radius: 12px;
  border: 2px solid #d4af37;
  box-shadow: inset 0 2px 5px rgba(212,175,55,0.2);
  height: 30px;
  overflow: hidden;
}

.progress-bar {
  height: 100%;
  width: 0;
  background: linear-gradient(90deg, #d4af37, #ffd700);
  text-align: center;
  color: #0d0d0d;
  font-weight: bold;
  line-height: 30px;
  transition: width 0.5s ease;
  box-shadow: 0 0 10px rgba(255,215,0,0.5);
  border-radius: 12px 0 0 12px;
}


.sidebar {
  transition: width 0.3s, transform 0.3s;
}

/* ปุ่ม Floating Balloon */
#menu-balloon {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 60px;
  height: 60px;
  background: linear-gradient(145deg, #d4af37, #ffd700);
  border-radius: 50%;
  box-shadow: 0 4px 15px rgba(212,175,55,0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  z-index: 2000;
  transition: transform 0.2s;
}
#menu-balloon:hover {
  transform: scale(1.1);
}
#menu-balloon span {
  font-size: 28px;
  color: #0d0d0d;
  font-weight: bold;
}

/* เมนูลอย (Overlay) */
.sidebar-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 260px;
  height: 100vh;
  background: linear-gradient(180deg, #1a1a1a, #333333);
  box-shadow: 2px 0 10px rgba(0,0,0,0.7);
  transform: translateX(-100%);
  transition: transform 0.3s ease;
  z-index: 1999;
  display: flex;
  flex-direction: column;
}
.sidebar-overlay.active {
  transform: translateX(0);
}

/* ปุ่ม Floating Balloon */
#menu-balloon {
  position: fixed;
  bottom: 25px;
  right: 25px;
  width: 65px;
  height: 65px;
  background: radial-gradient(circle at 30% 30%, #ffd700, #a67c00);
  border-radius: 50%;
  box-shadow: 0 6px 18px rgba(0,0,0,0.6), inset 0 2px 6px rgba(255,255,255,0.2);
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  z-index: 2000;
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}
#menu-balloon:hover {
  transform: scale(1.1);
  box-shadow: 0 8px 20px rgba(255,215,0,0.7);
}
#menu-balloon i {
  font-size: 28px;
  color: #0d0d0d;
  font-weight: bold;
}

/* Sidebar Overlay */
.sidebar-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 260px;
  height: 100vh;
  background: rgba(20,20,20,0.9);
  backdrop-filter: blur(10px);
  border-right: 2px solid rgba(255,215,0,0.4);
  box-shadow: 4px 0 15px rgba(0,0,0,0.8);
  transform: translateX(-100%);
  transition: transform 0.35s ease-in-out;
  z-index: 1999;
  padding: 20px;
  display: flex;
  flex-direction: column;
  border-radius: 0 20px 20px 0;
}
.sidebar-overlay.active {
  transform: translateX(0);
}

/* Title */
.sidebar-overlay h2 {
  color: #ffd700;
  text-align: center;
  margin-bottom: 20px;
  font-family: "Segoe UI", sans-serif;
  font-weight: 600;
}

/* Menu Buttons */
.sidebar-overlay button {
  background: linear-gradient(145deg, #1c1c1c, #2a2a2a);
  border: 1px solid rgba(255,215,0,0.4);
  color: #f0f0f0;
  padding: 12px;
  margin: 8px 0;
  border-radius: 12px;
  cursor: pointer;
  font-size: 15px;
  text-align: left;
  transition: background 0.25s, transform 0.2s;
}
.sidebar-overlay button:hover {
  background: linear-gradient(145deg, #2a2a2a, #3a3a3a);
  transform: translateX(5px);
  color: #ffd700;
  border-color: #ffd700;
}


.sidebar-overlay {
  pointer-events: none; /* ทั้ง overlay จะไม่กิน event */
}

.sidebar-overlay.active {
  pointer-events: auto; /* แต่เวลา active เปิดให้คลิกได้ */
}

#menu-balloon {
  position: fixed;
  bottom: 25px;
  right: 25px;
  z-index: 3000; /* ยกให้สูงกว่า overlay */
}

.graph-buttons button {
  background: linear-gradient(145deg, #1c1c1c, #2a2a2a);
  border: 1px solid rgba(255,215,0,0.4);
  color: #f0e6d2;
  border-radius: 10px;
  font-weight: 600;
  transition: all 0.3s ease;
}
.graph-buttons button:hover {
  background: linear-gradient(145deg, #2a2a2a, #3a3a3a);
  color: #ffd700;
  border-color: #ffd700;
}
.graph-buttons button.active {
  background: linear-gradient(145deg, #d4af37, #ffd700);
  color: #0d0d0d;
  box-shadow: 0 0 10px rgba(255,215,0,0.7);
}

canvas {
  width: 100% !important;
  max-width: 100%;
  height: 300px; /* กำหนดความสูงคงที่ หรือปรับตามขนาดมือถือ */
  display: none;
}
@media (max-width: 600px) {
  canvas {
    height: 220px; /* ความสูงเหมาะสมบนมือถือ */
  }
}

.graph-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.graph-buttons button {
  flex: 1 1 45%; /* desktop */
}

@media (max-width: 600px) {
  .graph-buttons button {
    flex: 1 1 100%; /* แถวละปุ่มบนมือถือ */
    font-size: 14px;
    padding: 10px;
  }
}



</style>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">
</head>
<body>
 <!-- Floating Balloon -->
<div id="menu-balloon"><span>☰</span></div>

<!-- Sidebar Overlay -->
<div class="sidebar-overlay" id="sidebarOverlay">
  <h2>Menu</h2>
  <button onclick="showTab('investment')" class="active">Statistic</button>
  <button onclick="showTab('expense')">Portflorio</button>
  <button onclick="showTab('hall')">Hall of Legend</button>
  <button onclick="showTab('goal')">Goal</button>
  <button onclick="openCalendar()">Calendar</button>
</div>
 
  
<div class="container">
  

  <div class="main">
    <!-- Tab 1: Investment Zone -->
    <div id="investment" class="tab-content">
      <h1>Statistic</h1>
      <div class="graph-buttons">
        <button onclick="showGraph('baht')" class="active">มูลค่าบาทสะสม</button>
        <button onclick="showGraph('dollar')">มูลค่าดอลลาร์สะสม</button>
        <button onclick="showGraph('ratio')">สัดส่วนบาท-ดอลลาร์</button>
        <button onclick="showGraph('percent')">เปอร์เซ็นต์บาทต่อดอลลาร์</button>
      </div>
      <canvas id="chartBaht"></canvas>
      <canvas id="chartDollar"></canvas>
      <canvas id="chartRatio"></canvas>
      <canvas id="chartPercent"></canvas>

      <div class="input-box">
        <input type="number" id="baht" placeholder="บาท">
        <input type="number" id="dollar" placeholder="ดอลลาร์">
        <button onclick="addData()" >เพิ่มข้อมูล</button>
      </div>

      <div class="delete-box">
        <button onclick="deleteSelected()">ลบแถวที่เลือก</button>
      </div>

      <h2>ตาราง 1: Sum บาท</h2>
      <table id="tableBaht"><thead><tr><th>รอบ</th><th>บาทสะสม</th></tr></thead><tbody></tbody></table>

      <h2>ตาราง 2: Sum ดอลลาร์</h2>
      <table id="tableDollar"><thead><tr><th>รอบ</th><th>ดอลลาร์สะสม</th></tr></thead><tbody></tbody></table>

      <h2>ตาราง 3: บาท/ดอลลาร์</h2>
      <table id="tableRatio"><thead><tr><th>รอบ</th><th>บาท</th><th>ดอลลาร์</th></tr></thead><tbody></tbody></table>
    </div>

    <!-- Tab 2: % พอร์ตของฉัน -->
<div id="expense" class="tab-content" style="display:none;">
  <h1>My Portflorio</h1>
  
  <div class="input-box">
    <input type="text" id="stockName" placeholder="ชื่อหุ้น">
    <input type="number" id="stockAmount" placeholder="จำนวนเงิน USD">
    <input type="number" id="stockCashFlow" placeholder="Cash Flow USD">
    <button onclick="addStock()">เพิ่มข้อมูล</button>
  </div>

  <div class="delete-box">
    <button onclick="deleteSelectedStock()">ลบแถวที่เลือก</button>
  </div>

  <canvas id="pieChart"></canvas>

  <h2>ตารางสัดส่วนการลงทุน</h2>
  <table id="tableStock">
    <thead><tr><th>รอบ</th><th>ชื่อหุ้น</th><th>จำนวนเงิน USD</th><th> - </th></tr></thead>
    <tbody></tbody>
  </table>
</div>

<!-- Tab 3: Hall of Fame -->
<div id="hall" class="tab-content" style="display:none;">
  <h1 style="font-family: 'Cinzel', serif; text-shadow: 2px 2px 5px #000;">Hall of Legend</h1>

  <div class="input-box">
    <input type="text" id="hallName" placeholder="Name">
    <input type="file" id="hallImageFile" accept="image/*">
    <button onclick="addHall()">Accept the Legend</button>
  </div>

  <div class="hall-container" id="hallContainer"></div>
</div>


<!-- Tab 4: Goal -->
<div id="goal" class="tab-content" style="display:none;">
  <h1>Goal</h1>
  
  <div class="input-box">
    <input type="number" id="goalTarget" placeholder="ตั้งเป้า USD">
    <button onclick="setGoal()">ตั้งค่า Goal</button>
  </div>

  <div id="goalStatus" style="margin-top:20px; font-size:18px; font-weight:600; color:#f0e6d2;">
    ยังไม่ได้ตั้ง Goal
  </div>

  <div class="progress-bar-container">
    <div id="goalProgress" class="progress-bar">0%</div>
  </div>
</div>




  </div>
</div>

<script>

    function showTab(tab){
    document.querySelectorAll('.tab-content').forEach(c=>c.style.display='none');
    document.getElementById(tab).style.display='block';
    document.querySelectorAll('.sidebar button').forEach(b=>b.classList.remove('active'));
    document.querySelector(`.sidebar button[onclick="showTab('${tab}')"]`).classList.add('active');
    }

    // ===== Investment Zone Logic =====
    let bahtData = JSON.parse(localStorage.getItem('bahtData')) || [];
    let dollarData = JSON.parse(localStorage.getItem('dollarData')) || [];
    let selectedIndex = null;

    function addData() {
    let baht = parseFloat(document.getElementById('baht').value) || 0;
    let dollar = parseFloat(document.getElementById('dollar').value) || 0;
    bahtData.push(baht);
    dollarData.push(dollar);
    saveData();
    updateTables();
    updateCharts();
    }

    function deleteSelected() {
    if(selectedIndex!==null){
        bahtData.splice(selectedIndex,1);
        dollarData.splice(selectedIndex,1);
        selectedIndex = null;
        saveData();
        updateTables();
        updateCharts();
    }
    }

    function saveData() {
    localStorage.setItem('bahtData',JSON.stringify(bahtData));
    localStorage.setItem('dollarData',JSON.stringify(dollarData));
    }

    function sumArray(arr){ let sum=0; return arr.map(v=>sum+=v); }

    function updateTables(){
    const tableBahtBody = document.querySelector('#tableBaht tbody');
    const tableDollarBody = document.querySelector('#tableDollar tbody');
    const tableRatioBody = document.querySelector('#tableRatio tbody');
    const bahtSum = sumArray(bahtData);
    const dollarSum = sumArray(dollarData);

    tableBahtBody.innerHTML='';
    tableDollarBody.innerHTML='';
    tableRatioBody.innerHTML='';

    for(let i=0;i<bahtData.length;i++){
        tableBahtBody.innerHTML += `<tr onclick="selectRow(${i})" class="${selectedIndex===i?'selected':''}"><td>${i+1}</td><td>${bahtSum[i]}</td></tr>`;
        tableDollarBody.innerHTML += `<tr onclick="selectRow(${i})" class="${selectedIndex===i?'selected':''}"><td>${i+1}</td><td>${dollarSum[i]}</td></tr>`;
        tableRatioBody.innerHTML += `<tr onclick="selectRow(${i})" class="${selectedIndex===i?'selected':''}"><td>${i+1}</td><td>${bahtData[i]}</td><td>${dollarData[i]}</td></tr>`;
    }
    }

    function selectRow(i){ selectedIndex = (selectedIndex===i)?null:i; updateTables(); }

    let charts={};
    function updateCharts(){
      const labels = bahtData.map((_,i)=>i+1);
      const bahtSum = sumArray(bahtData);
      const dollarSum = sumArray(dollarData);
      const percentData = bahtData.map((b,i)=>dollarData[i]? (b/dollarData[i]*100).toFixed(2):0);

      const ctxBaht=document.getElementById('chartBaht').getContext('2d');
      const ctxDollar=document.getElementById('chartDollar').getContext('2d');
      const ctxRatio=document.getElementById('chartRatio').getContext('2d');
      const ctxPercent=document.getElementById('chartPercent').getContext('2d');

      if(charts.baht) charts.baht.destroy();
      if(charts.dollar) charts.dollar.destroy();
      if(charts.ratio) charts.ratio.destroy();
      if(charts.percent) charts.percent.destroy();

      const commonOptions = {
        responsive:true,
        plugins:{
          legend:{ labels:{ color:'#f0e6d2' } }
        },
        scales:{
          x:{ ticks:{ color:'#f0e6d2' }, grid:{ color:'#333' } },
          y:{ ticks:{ color:'#f0e6d2' }, grid:{ color:'#333' } }
        }
      };

      charts.baht = new Chart(ctxBaht,{ type:'line', data:{ labels, datasets:[{ label:'Baht Sum', data:bahtSum, borderColor:'#d4af37', fill:false, tension:0.3 }] }, options:commonOptions });
      charts.dollar = new Chart(ctxDollar,{ type:'line', data:{ labels, datasets:[{ label:'Dollar Sum', data:dollarSum, borderColor:'#1e90ff', fill:false, tension:0.3 }] }, options:commonOptions });
      charts.ratio = new Chart(ctxRatio,{ type:'line', data:{ labels, datasets:[{ label:'Baht', data:bahtData, borderColor:'#d4af37', fill:false, tension:0.3 },{ label:'Dollar', data:dollarData, borderColor:'#1e90ff', fill:false, tension:0.3 }] }, options:commonOptions });
      charts.percent = new Chart(ctxPercent,{ type:'line', data:{ labels, datasets:[{ label:'Baht % Dollar', data:percentData, borderColor:'#ff8c00', fill:false, tension:0.3 }] }, options:commonOptions });
    }

    function showGraph(name){
        document.querySelectorAll('#investment canvas').forEach(c=>c.style.display='none');
        document.getElementById('chart'+capitalize(name)).style.display='block';
        document.querySelectorAll('#investment .graph-buttons button').forEach(b=>b.classList.remove('active'));
        document.querySelector(`#investment .graph-buttons button[onclick="showGraph('${name}')"]`).classList.add('active');
    }

    function capitalize(s){ return s.charAt(0).toUpperCase()+s.slice(1); }

    // ===== % Portfolio Logic =====
    let stocks = JSON.parse(localStorage.getItem('stocks')) || [];
    let selectedStockIndex = null;
    let pie;

    function addStock() {
        let name = document.getElementById('stockName').value.trim();
        let amount = parseFloat(document.getElementById('stockAmount').value) || 0;
        let cashFlow = parseFloat(document.getElementById('stockCashFlow').value) || 0;
        if(name && amount > 0){
            stocks.push({name, amount, cashFlow});
            saveStocks();
            updateStockTable();
            updatePieChart();
            updateGoalProgress(); 
        }
    }

    function deleteSelectedStock() {
        if(selectedStockIndex !== null){
            stocks.splice(selectedStockIndex,1);
            selectedStockIndex = null;
            saveStocks();
            updateStockTable();
            updatePieChart();
            updateGoalProgress(); 
        }
    }

    function saveStocks() {
        localStorage.setItem('stocks', JSON.stringify(stocks));
    }

    function updateStockTable() {
        const tbody = document.querySelector('#tableStock tbody');
        tbody.innerHTML = '';
        stocks.forEach((s,i)=>{
            tbody.innerHTML += `<tr onclick="selectStock(${i})" class="${selectedStockIndex===i?'selected':''}">
            <td>${i+1}</td>
            <td>${s.name}</td>
            <td>${s.amount}</td>
            <td>${s.cashFlow}</td>
            </tr>`;
        });
    }

    function selectStock(i) {
        selectedStockIndex = (selectedStockIndex===i)?null:i;
        updateStockTable();
    }
    
    function updatePieChart(){
      const ctx=document.getElementById('pieChart').getContext('2d');
      const labels=stocks.map(s=>s.name);
      const data=stocks.map(s=>s.amount);
      const total=data.reduce((a,b)=>a+b,0);
      if(pie) pie.destroy();
      const goldShades=['#FFD700','#FFC107','#FFB800','#FFAA00','#FF9900','#FF8C00'];
      const borderColors=['#f0e6d2','#ffffff'];
      const backgroundColors=data.map((_,i)=>goldShades[i%goldShades.length]);
      const borders=data.map((_,i)=>borderColors[i%borderColors.length]);
      pie=new Chart(ctx,{
        type:'pie',
        data:{ labels:labels.map((l,i)=>`${l} (${total?((data[i]/total)*100).toFixed(2):0}%)`), datasets:[{ data, backgroundColor:backgroundColors, borderColor:borders, borderWidth:3, hoverOffset:15, hoverBorderColor:'#fff', hoverBorderWidth:5 }] },
        options:{ responsive:true, plugins:{ legend:{ position:'right', labels:{ color:'#f0e6d2', font:{ size:14, weight:'600' } } } } }
      });
    }

    // ===== Hall of Legend Logic (อัปเดตใหม่ทั้งหมด) =====
    let hallData = JSON.parse(localStorage.getItem('hallData')) || [];
    const rankSymbols = [
    '♛ The CPA',
    '✺ Predator',
    '✹ Master',
    '✸ Diamond',
    '✪ Platinum',
    '✧ Gold',
    '🜁 Silver',
    '🜃 Bronze',
    '🜄 Rookie',
    '🜂 Climber',
];

    function addHall() {
      const name = document.getElementById('hallName').value.trim();
      const fileInput = document.getElementById('hallImageFile');
      const file = fileInput.files[0];

      if(!name || !file){
        alert("กรุณาใส่ชื่อและเลือกไฟล์รูปภาพด้วยครับ");
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e){
        const imageData = e.target.result;
        // เพิ่มข้อมูลใหม่ไว้บนสุดเสมอ (อันดับ 1 ชั่วคราว)
        hallData.unshift({name, image: imageData}); 
        saveHall();
        renderHall();
        document.getElementById('hallName').value = '';
        fileInput.value = '';
      }
      reader.readAsDataURL(file);
    }

    function saveHall(){
      localStorage.setItem('hallData', JSON.stringify(hallData));
    }

    function renderHall(){
      const container = document.getElementById('hallContainer');
      container.innerHTML = '';
      hallData.forEach((h, index) => {
        const div = document.createElement('div');
        div.className = 'hall-item';

        // เพิ่มสัญลักษณ์ Rank ถ้าอยู่ใน 10 อันดับแรก
        if (index < rankSymbols.length) {
            const rankSpan = document.createElement('span');
            rankSpan.className = 'rank-symbol';
            rankSpan.textContent = rankSymbols[index];
            div.appendChild(rankSpan);
        }

        const img = document.createElement('img');
        img.src = h.image;
        img.alt = h.name;
        
        // ปรับแสงกรอบตามอันดับ
        const glowOpacity = Math.max(0.1, 0.9 - (index * 0.08)).toFixed(2);
        const glowBlur = Math.max(5, 20 - (index * 1.5));
        img.style.boxShadow = `0 0 ${glowBlur}px rgba(255, 215, 0, ${glowOpacity})`;

        const nameSpan = document.createElement('span');
        nameSpan.textContent = h.name;

        const delBtn = document.createElement('button');
        delBtn.textContent = 'Disrespect';
        delBtn.style.marginTop = '5px';
        delBtn.style.cursor = 'pointer';
        delBtn.style.background = '#990000';
        delBtn.style.color = '#fff';
        delBtn.style.border = 'none';
        delBtn.style.borderRadius = '6px';
        delBtn.style.padding = '2px 6px';
        delBtn.onclick = (e) => {
          e.stopPropagation(); // ป้องกันการลากทำงานตอนกดลบ
          hallData.splice(index, 1);
          saveHall();
          renderHall();
        }

        div.appendChild(img);
        div.appendChild(nameSpan);
        div.appendChild(delBtn);
        container.appendChild(div);
      });
    }

    // ===== Goal Logic =====
    let goalTarget = parseFloat(localStorage.getItem('goalTarget')) || 0;

    function setGoal() {
      const input = document.getElementById('goalTarget').value;
      if (!input || input <= 0) {
        alert("กรุณาใส่เป้าหมายที่ถูกต้อง");
        return;
      }
      goalTarget = parseFloat(input);
      localStorage.setItem('goalTarget', goalTarget); 
      updateGoalProgress();
    }

    function updateGoalProgress() {
      const goalStatus = document.getElementById('goalStatus');
      const goalProgress = document.getElementById('goalProgress');
      const totalPortfolioValue = stocks.reduce((sum, stock) => sum + stock.amount, 0);

      if (goalTarget > 0) {
        const percent = Math.min((totalPortfolioValue / goalTarget) * 100, 100).toFixed(1);
        goalStatus.textContent = `สะสมแล้ว ${totalPortfolioValue.toLocaleString()} / ${goalTarget.toLocaleString()} USD (${percent}%)`;
        goalProgress.style.width = percent + "%";
        goalProgress.textContent = percent + "%";
      } else {
        goalStatus.textContent = "ยังไม่ได้ตั้ง Goal";
        goalProgress.style.width = "0%";
        goalProgress.textContent = "0%";
      }
    }

    // ===== Initial Load =====
    function initialize() {
        // Investment Zone
        updateTables();
        updateCharts();
        showGraph('baht');

        // Portfolio
        updateStockTable();
        updatePieChart();

        // Hall of Legend
        renderHall();
        const hallContainer = document.getElementById('hallContainer');
        new Sortable(hallContainer, {
            animation: 150, // ความเร็วในการเคลื่อนไหว
            onEnd: function (evt) {
                // ย้ายข้อมูลใน Array ตามการลาก
                const [movedItem] = hallData.splice(evt.oldIndex, 1);
                hallData.splice(evt.newIndex, 0, movedItem);

                // บันทึกและวาดใหม่
                saveHall();
                renderHall();
            },
        });

        // Goal
        if(goalTarget > 0){
            document.getElementById('goalTarget').value = goalTarget;
        }
        updateGoalProgress();
    }

    document.addEventListener('DOMContentLoaded', initialize);

    function openCalendar() {
    window.location.href = 'calender.html'; // เปลี่ยนหน้าไป calendar.html
}

document.getElementById("menu-balloon").addEventListener("click", () => {
  document.getElementById("sidebarOverlay").classList.toggle("active");
});

charts.baht = new Chart(ctxBaht,{ 
  type:'line', 
  data:{ labels, datasets:[{ label:'Baht Sum', data:bahtSum, borderColor:'#ffd700', fill:false, tension:0.3 }] }, 
  options:commonOptions 
});
charts.dollar = new Chart(ctxDollar,{ 
  type:'line', 
  data:{ labels, datasets:[{ label:'Dollar Sum', data:dollarSum, borderColor:'#ffcc33', fill:false, tension:0.3 }] }, 
  options:commonOptions 
});
charts.ratio = new Chart(ctxRatio,{ 
  type:'line', 
  data:{ labels, datasets:[{ label:'Baht', data:bahtData, borderColor:'#ffd700', fill:false, tension:0.3 },{ label:'Dollar', data:dollarData, borderColor:'#ffcc33', fill:false, tension:0.3 }] }, 
  options:commonOptions 
});
charts.percent = new Chart(ctxPercent,{ 
  type:'line', 
  data:{ labels, datasets:[{ label:'Baht % Dollar', data:percentData, borderColor:'#ffae42', fill:false, tension:0.3 }] }, 
  options:commonOptions 
});

function showTab(tab){
    // ซ่อน tab อื่น
    document.querySelectorAll('.tab-content').forEach(c => c.style.display='none');
    // แสดง tab ที่เลือก
    document.getElementById(tab).style.display='block';
    
    // อัปเดตปุ่ม sidebar ให้ active
    document.querySelectorAll('.sidebar-overlay button').forEach(b => b.classList.remove('active'));
    document.querySelector(`.sidebar-overlay button[onclick="showTab('${tab}')"]`).classList.add('active');

    // 🔥 ปิด sidebarOverlay อัตโนมัติ
    document.getElementById("sidebarOverlay").classList.remove("active");
}


</script>
</body>
</html>
